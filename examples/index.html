<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>Leaflet GBFS</title>
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />
        <link rel="stylesheet" href="../dist/L.GBFS.css" />
        <style>
            #map {
                position: absolute;
                top: 0;
                left: 0;
                bottom: 0;
                right: 0;
            }
        </style>
    </head>
    <body>
        <div id="map"></div>

        <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet-src.js"></script>
        <script src="../dist/L.GBFS.js"></script>

        <script type="text/javascript">
            var map = L.map('map');

            L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',
                maxZoom: 19
            }).addTo(map);

            const urlParams = new URLSearchParams(document.location.search);
            let lat = Number(urlParams.get('lat') || '35.5403');
            let lon = Number(urlParams.get('lon') || '139.6987');
            let zoom = +urlParams.get('zoom') || 14;
            map.setView([lat, lon], zoom);

            let gbfsUrls = urlParams.getAll('gbfsUrl');
            if (gbfsUrls.length === 0) {
                gbfsUrls = [
                    'https://api-public.odpt.org/api/v4/gbfs/docomo-cycle/gbfs.json',
                    'https://api-public.odpt.org/api/v4/gbfs/hellocycling/gbfs.json',
                ];
            }
            let gbfsNames = urlParams.getAll('gbfsName');
            if (gbfsNames.length === 0) {
                // TODO: use system_id from system_information.json
                gbfsNames = ['docomo-cycle', 'hellocycling'];
            }
            let gbfsColors = urlParams.getAll('gbfsColor');
            if (gbfsColors.length === 0) {
                // TODO: use brand_assets.color from system_information.json
                gbfsColors = ['#cc0033', '#fabe00']; //'#C2D32C'
            }
            const overlays = {};
            gbfsUrls.forEach((url, idx) => {
                overlays[gbfsNames[idx]] = new L.GBFS({
                    gbfsURL: url,
                    stationMarkerBgColor: gbfsColors[idx],
                }).addTo(map);
            });
            L.control.layers(null, overlays, { collapsed: false }).addTo(map);
        </script>
    </body>
</html>
